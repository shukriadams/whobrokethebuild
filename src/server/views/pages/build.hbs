{{#extend "layout"}}
    {{#content "body"}}
        
        <h1>Build #{{build.build}}</h1>
        <x-columns class="--two">
            <x-card class="--stroke --top">
                <x-card-stroke class="--{{statusTranslate build.status}}"></x-card-stroke>
                <x-card-pad>
                    Status : {{statusAndDeltaTranslate build.status build.delta}}
                    {{#if responsibleBreakingBuild}}
                        <a href="/build/{{responsibleBreakingBuild.id}}">{{responsibleBreakingBuild.build}}</a>
                    {{/if}}

                    {{#if buildBreakers}}
                        <div>
                            Broken by :
                            {{#each buildBreakers}}
                                <a href="/user/{{id}}">{{name}}</a>
                            {{/each}}
                        </div>
                    {{/if}}
                </x-card-pad>
                <x-card-pad>
                    Job : <a href="/job/{{build.jobId}}">{{job.name}}</a>
                </x-card-pad>
                <x-card-pad>
                    Built on :  {{build.host}}
                </x-card-pad>
                <x-card-pad>
                    <a href="{{linkToBuild}}">View on {{ciServer.name}}</a>
                </x-card-pad>
            </x-card>
            <x-card class="--top">
                <x-card-pad>
                    <h6>Timeline</h6>
                    Ran on {{shortDateAndTime build.started}} ({{ago build.started}}{{#if build.ended}} )
                    <div>
                        
                    </div>
                    <div>
                        Took {{durationLong build.ended build.started}} to complete{{/if}}
                    </div>
                </x-card-pad>
                <x-card-pad>
                    {{#if previousBuild}}
                        Previous build : <a href="/build/{{previousBuild.id}}"> ({{durationLong build.started previousBuild.started}})</a>
                    {{/if}}
                </x-card-pad>
                <x-card-pad>
                    {{#if nextBuild}}
                        Next  build : <a href="/build/{{nextBuild.id}}"> ({{durationLong nextBuild.started build.started}})</a>
                    {{/if}}
                </x-card-pad>
                <x-card-pad>
                    {{#if session.isAdmin}}
                        <div>
                            <h2>Admin</h2>
                            <button class="button --danger" data-id="{{build.id}}">Remove build</button>    
                        </div>
                    {{/if}}
                </x-card-pad>
            </x-card>
        </x-columns>

        
        <h2>Changes</h2>
            <x-list class="build-changes">
                {{#if build.involvements}}
                    {{#each build.involvements}}
                        <x-list-row>
                            <x-list-cell>
                                <div>
                                    #{{revision}} - <span class="bold">{{revisionObject.description}}</span> 
                                </div>
                                <div class="quiet" >
                                    {{buildInvolvementTranslate involvement}} by {{>buildInvolvementUserLink this}} 
                                </div>
                                {{#if revisionObject.files}}
{{!note, outer element is div so each file is on new line, and inner element is span so background color is behind text only}}                                
<pre class="code">{{#each revisionObject.files}}<div><span class="build-revisionFile build-revisionFile--{{#if isFault}}atFault{{/if}}">{{file}}</span></div>{{/each}}</pre>
                                {{else}}
                                    Revision data still being processed, check back later.
                                {{/if}}
                            </x-list-cell>
                        </x-list-row>
                    {{/each}}
                {{else}}
                        There are no revisions in this build
                {{/if}}
            </x-list>

                {{#eq build.status constants.BUILDSTATUS_FAILED}}
 
                    <h2>Log</h2>
<pre class="code">
{{#if build.logData}}{{#each build.logData}}{{text}}{{/each}}
{{else}}
Log is empty or has not been processed yet
{{/if}}
</pre>

{{#if build.logData}}
    <a href="/build/log/{{build.id}}">Full log</a>
{{/if}}

                {{/eq}}


    {{/content}}
{{/extend}}


